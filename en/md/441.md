# ID: 441 - Unintended Proxy or Intermediary ('Confused Deputy')
<h5>Name</h5>Unintended Proxy or Intermediary ('Confused Deputy')
<h5>Weakness</h5>Class
<h5>Status</h5>Draft
<h5>Description</h5>The software receives a request, message, or directive from an upstream component, but the software does not sufficiently preserve the original source of the request before forwarding the request to an external actor that is outside of the software's control sphere. This causes the software to appear to be the source of the request, leading it to act as a proxy or other intermediary between the upstream component and the external actor.
<h5>ExtendedDescription</h5>If an attacker cannot directly contact a target, but the software has access to the target, then the attacker can send a request to the software and have it be forwarded from the target. The request would appear to be coming from the software's system, not the attacker's system. As a result, the attacker can bypass access controls (such as firewalls) or hide the source of malicious requests, since the requests would not be coming directly from the attacker. Since proxy functionality and message-forwarding often serve a legitimate purpose, this issue only becomes a vulnerability when: The software runs with different privileges or on a different system, or otherwise has different levels of access than the upstream component; The attacker is prevented from making the request directly to the target; and The attacker can create a request that the proxy does not explicitly intend to be forwarded on the behalf of the requester. Such a request might point to an unexpected hostname, port number, or service. Or, the request might be sent to an allowed service, but the request could contain disallowed directives, commands, or resources.
<h5>RelatedWeaknesses</h5>::NATURE:ChildOf:CWE ID:610:VIEW ID:699:ORDINAL:Primary::NATURE:ChildOf:CWE ID:610:VIEW ID:1000:ORDINAL:Primary::NATURE:ChildOf:CWE ID:610:VIEW ID:1003:ORDINAL:Primary::NATURE:CanPrecede:CWE ID:668:VIEW ID:1000::
<h5>WeaknessOrdinalities</h5>null
<h5>ApplicablePlatforms</h5>:::LANGUAGE CLASS:Language-Independent:LANGUAGE PREVALENCE:Undetermined::
<h5>BackgroundDetails</h5>null
<h5>AlternateTerms</h5>::TERM:Confused Deputy:DESCRIPTION:This weakness is sometimes referred to as the Confused deputy problem, in which an attacker misused the authority of one victim (the confused deputy) when targeting another victim.::
<h5>ModesOfIntroduction</h5>:::PHASE:Architecture and Design:DESCRIPTION:::
<h5>ExploitationFactors</h5>null
<h5>LikelihoodofExploit</h5>null
<h5>CommonConsequences</h5>::SCOPE:Non-Repudiation:SCOPE:Access Control:TECHNICAL IMPACT:Gain Privileges or Assume Identity Hide Activities::
<h5>DetectionMethods</h5>null
<h5>PotentialMitigations</h5>::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:Enforce the use of strong mutual authentication mechanism between the two parties.::
<h5>ObservedExamples</h5>::REFERENCE:CVE-1999-0017:DESCRIPTION:FTP bounce attack. The design of the protocol allows an attacker to modify the PORT command to cause the FTP server to connect to other machines besides the attacker's.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0017REFERENCE:CVE-1999-0168:DESCRIPTION:RPC portmapper could redirect service requests from an attacker to another entity, which thinks the requests came from the portmapper.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0168REFERENCE:CVE-2005-0315:DESCRIPTION:FTP server does not ensure that the IP address in a PORT command is the same as the FTP user's session, allowing port scanning by proxy.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-0315REFERENCE:CVE-2002-1484:DESCRIPTION:Web server allows attackers to request a URL from another server, including other ports, which allows proxied scanning.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-1484REFERENCE:CVE-2004-2061:DESCRIPTION:CGI script accepts and retrieves incoming URLs.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-2061REFERENCE:CVE-2001-1484:DESCRIPTION:Bounce attack allows access to TFTP from trusted side.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2001-1484REFERENCE:CVE-2010-1637:DESCRIPTION:Web-based mail program allows internal network scanning using a modified POP3 port number.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1637REFERENCE:CVE-2009-0037:DESCRIPTION:URL-downloading library automatically follows redirects to file:// and scp:// URLs:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-0037
<h5>FunctionalAreas</h5>null
<h5>AffectedResources</h5>null
<h5>TaxonomyMappings</h5>TAXONOMY NAME:PLOVER:ENTRY NAME:Unintended proxy/intermediary::::TAXONOMY NAME:PLOVER:ENTRY NAME:Proxied Trusted Channel::::TAXONOMY NAME:WASC:ENTRY ID:32:ENTRY NAME:Routing Detour::
<h5>RelatedAttackPatterns</h5>::141::142::219::465::
<h5>Notes</h5>TYPE:Relationship:NOTE:This weakness has a chaining relationship with CWE-668 (Exposure of Resource to Wrong Sphere) because the proxy effectively provides the attacker with access to the target's resources that the attacker cannot directly obtain.::::TYPE:Maintenance:NOTE:This could possibly be considered as an emergent resource.::::TYPE:Theoretical:NOTE:It could be argued that the confused deputy is a fundamental aspect of most vulnerabilities that require an active attacker. Even for common implementation issues such as buffer overflows, SQL injection, OS command injection, and path traversal, the vulnerable program already has the authorization to run code or access files. The vulnerability arises when the attacker causes the program to run unexpected code or access unexpected files.::

