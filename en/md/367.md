# ID: 367 - Time-of-check Time-of-use (TOCTOU) Race Condition
<h5>Name</h5>Time-of-check Time-of-use (TOCTOU) Race Condition
<h5>Weakness</h5>Base
<h5>Status</h5>Incomplete
<h5>Description</h5>The software checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the software to perform invalid actions when the resource is in an unexpected state.
<h5>ExtendedDescription</h5>This weakness can be security-relevant when an attacker can influence the state of the resource between check and use. This can happen with shared resources such as files, memory, or even variables in multithreaded programs.
<h5>RelatedWeaknesses</h5>::NATURE:ChildOf:CWE ID:362:VIEW ID:1000:ORDINAL:Primary::NATURE:ChildOf:CWE ID:362:VIEW ID:699:ORDINAL:Primary::
<h5>WeaknessOrdinalities</h5>null
<h5>ApplicablePlatforms</h5>:::LANGUAGE CLASS:Language-Independent:LANGUAGE PREVALENCE:Undetermined::
<h5>BackgroundDetails</h5>null
<h5>AlternateTerms</h5>::TERM:TOCTTOU:DESCRIPTION:The TOCTTOU acronym expands to Time Of Check To Time Of Use.::TERM:TOCCTOU:DESCRIPTION:The TOCCTOU acronym is most likely a typo of TOCTTOU, but it has been used in some influential documents, so the typo is repeated fairly frequently.::
<h5>ModesOfIntroduction</h5>:::PHASE:Implementation:DESCRIPTION:::
<h5>ExploitationFactors</h5>null
<h5>LikelihoodofExploit</h5>null
<h5>CommonConsequences</h5>::SCOPE:Integrity:SCOPE:Other:TECHNICAL IMPACT:Alter Execution Logic Unexpected State:NOTE:Integrity Other Alter Execution Logic Unexpected State The attacker can gain access to otherwise unauthorized resources.::SCOPE:Integrity:SCOPE:Other:TECHNICAL IMPACT:Modify Application Data Modify Files or Directories Modify Memory Other:NOTE:Integrity Other Modify Application Data Modify Files or Directories Modify Memory Other Race conditions such as this kind may be employed to gain read or write access to resources which are not normally readable or writable by the user in question.::SCOPE:Integrity:SCOPE:Other:TECHNICAL IMPACT:Other:NOTE:Integrity Other Other The resource in question, or other resources (through the corrupted one), may be changed in undesirable ways by a malicious user.::SCOPE:Non-Repudiation:TECHNICAL IMPACT:Hide Activities:NOTE:Non-Repudiation Hide Activities If a file or other resource is written in this method, as opposed to in a valid way, logging of the activity may not occur.::SCOPE:Non-Repudiation:SCOPE:Other:TECHNICAL IMPACT:Other:NOTE:Non-Repudiation Other Other In some cases it may be possible to delete files a malicious user might not otherwise have access to, such as log files.::
<h5>DetectionMethods</h5>null
<h5>PotentialMitigations</h5>::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:The most basic advice for TOCTOU vulnerabilities is to not perform a check before the use. This does not resolve the underlying issue of the execution of a function on a resource whose state and identity cannot be assured, but it does help to limit the false sense of security given by the check.::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:When the file being altered is owned by the current user and group, set the effective gid and uid to that of the current user and group when executing this statement.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:Limit the interleaving of operations on files from multiple processes.::PHASE:Implementation Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:If you cannot perform operations atomically and you must share access to the resource between multiple processes or threads, then try to limit the amount of time (CPU cycles) between the check and use of the resource. This will not fix the problem, but it could make it more difficult for an attack to succeed.::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:Recheck the resource after the use call to verify that the action was taken appropriately.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:Ensure that some environmental locking mechanism can be used to protect resources effectively.::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:Ensure that locking occurs before the check, as opposed to afterwards, such that the resource, as checked, is the same as it is when in use.::
<h5>ObservedExamples</h5>::REFERENCE:CVE-2003-0813:DESCRIPTION:A multi-threaded race condition allows remote attackers to cause a denial of service (crash or reboot) by causing two threads to process the same RPC request, which causes one thread to use memory after it has been freed.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-0813REFERENCE:CVE-2004-0594:DESCRIPTION:PHP flaw allows remote attackers to execute arbitrary code by aborting execution before the initialization of key data structures is complete.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0594REFERENCE:CVE-2008-2958:DESCRIPTION:chain: time-of-check time-of-use (TOCTOU) race condition in program allows bypass of protection mechanism that was designed to prevent symlink attacks.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-2958REFERENCE:CVE-2008-1570:DESCRIPTION:chain: time-of-check time-of-use (TOCTOU) race condition in program allows bypass of protection mechanism that was designed to prevent symlink attacks.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-1570
<h5>FunctionalAreas</h5>null
<h5>AffectedResources</h5>null
<h5>TaxonomyMappings</h5>TAXONOMY NAME:PLOVER:ENTRY NAME:Time-of-check Time-of-use race condition::::TAXONOMY NAME:7 Pernicious Kingdoms:ENTRY NAME:File Access Race Conditions: TOCTOU::::TAXONOMY NAME:CLASP:ENTRY NAME:Time of check, time of use race condition::::TAXONOMY NAME:CERT C Secure Coding:ENTRY ID:FIO01-C:ENTRY NAME:Be careful using functions that use file names for identification::::TAXONOMY NAME:Software Fault Patterns:ENTRY ID:SFP20:ENTRY NAME:Race Condition Window::
<h5>RelatedAttackPatterns</h5>::27::29::
<h5>Notes</h5>TYPE:Relationship:NOTE:TOCTOU issues do not always involve symlinks, and not every symlink issue is a TOCTOU problem.::::TYPE:Research Gap:NOTE:Non-symlink TOCTOU issues are not reported frequently, but they are likely to occur in code that attempts to be secure.::

