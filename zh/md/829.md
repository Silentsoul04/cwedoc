# ID: 829 - 包含来自不可信控制域的功能
<h5>名称</h5>包含来自不可信控制域的功能
<h5>弱点抽象</h5>班级，等级
<h5>状态</h5>不完全
<h5>描述</h5>软件从预期控制范围之外的源导入、要求或包括可执行功能(例如库)。
<h5>扩展描述</h5>当包含第三方功能(如web小部件、库或其他功能源)时，软件必须有效地信任该功能。如果没有足够的保护机制，该功能在本质上可能是恶意的(要么来自不受信任的源，要么被欺骗，或者在从受信任源的传输中被修改)。该功能还可能包含其自身的缺陷，或者授予对其他功能和状态信息的访问权限，这些功能和状态信息应该保持对基本系统的私有，例如系统状态信息、敏感应用程序数据或Web应用程序的DOM。这可能会导致许多不同的后果，取决于所包含的功能，但一些例子包括注入恶意软件、通过授予不受信任功能的过多权限或权限来暴露信息、基于DOM的XSS漏洞、窃取用户的cookie或打开重定向到恶意软件(CWE-601)。
<h5>相关的弱点</h5>*性质：子女：CWE ID：669：视图ID：1000：序数：初级：自然：子女：CWE ID：669：视图ID：699：序号：主要：
<h5>弱点规律</h5>空
<h5>适用的平台</h5>空
<h5>背景细节</h5>空
<h5>替代条款</h5>空
<h5>模式的介绍</h5>*阶段：执行：说明：
<h5>剥削因素</h5>空
<h5>利用的可能性</h5>空
<h5>常见的后果</h5>：：SCOPE：Confidentiality：SCOPE：Integrity：SCOPE：Availability：TECHNICAL影响：执行未经授权的代码或命令：注意：机密完整性可用性执行未经授权的代码或命令攻击者可以通过将程序下载到不受信任的控制领域(例如恶意网站)来将恶意功能插入到程序中。
<h5>检测方法</h5>：：METHOD：Automated Static Analysis-Binary or Bytecode：EFFECTIVENESS：SOAR Partial：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Cost effective for partial coverage：Bytecode Weakness Analysis-including disassembler+source code weakness analysis：：METHOD：Manual Static Analysis-Binary or Bytecode：EFFECTIVENESS：SOAR Partial：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Cost effective for partial coverage：Binary/Bytecode disassembler-then use manual analysis for vulnerabilities&anomalies：：METHOD：Dynamic Analysis with Manual结果解释：有效性：SOAR部分：描述：根据SOAR，以下检测技术可能有用：部分覆盖的成本效益：强制路径执行监视虚拟环境-在沙箱/包装/虚拟机中运行潜在的恶意代码，看看它是否做了任何可疑的事情：方法：手动静态分析-源代码：有效性：高：描述：根据SOAR，以下检测技术可能是有用的：高成本效益：手工源代码审查(不检查)对部分覆盖是有效的：Manual Spotcheck-Focused manual analysis of source：：METHOD：Automated Static Analysis-Source Code：EFFECTIVENESS：SOAR Partial：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Cost effective for partial coverage：Source code Weakness Analyzer Context-configured Source Code Weakness Analyzer：：METHOD：Architecture or Design Review：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Inspection(IEEE 1028 standard)(can apply to requirements，design，source code，etc.)部分覆盖的正式方法/按施工成本调整的有效方法：攻击建模：
<h5>潜在的缓解措施</h5>::PHASE:Architecture and Design:STRATEGY:Libraries or Frameworks:EFFECTIVENESS::DESCRIPTION:Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.::PHASE:Architecture and Design:STRATEGY:Enforcement by Conversion:EFFECTIVENESS::DESCRIPTION:When the set of acceptable objects, such as filenames or URLs, is limited or known, create a mapping from a set of fixed input values (such as numeric IDs) to the actual filenames or URLs, and reject all other inputs. For example, ID 1 could map to inbox.txt and ID 2 could map to profile.txt. Features such as the ESAPI AccessReferenceMap [REF-45] provide this capability.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.::PHASE:Architecture and Design Operation:STRATEGY:Sandbox or Jail:EFFECTIVENESS:Limited:DESCRIPTION:Run the code in a jail or similar sandbox environment that enforces strict boundaries between the process and the operating system. This may effectively restrict which files can be accessed in a particular directory or which commands can be executed by the software. OS-level examples include the Unix chroot jail, AppArmor, and SELinux. In general, managed code may provide some protection. For example, java.io.FilePermission in the Java SecurityManager allows the software to specify restrictions on file operations. This may not be a feasible solution, and it only limits the impact to the operating system; the rest of the application may still be subject to compromise. Be careful to avoid CWE-243 and other weaknesses related to jails.::PHASE:Architecture and Design Operation:STRATEGY:Environment Hardening:EFFECTIVENESS::DESCRIPTION:Run your code using the lowest privileges that are required to accomplish the necessary tasks [REF-76]. If possible, create isolated accounts with limited privileges that are only used for a single task. That way, a successful attack will not immediately give the attacker access to the rest of the software or its environment. For example, database applications rarely need to run as the database administrator, especially in day-to-day operations.::PHASE:Implementation:STRATEGY:Input Validation:EFFECTIVENESS::DESCRIPTION:Assume all input is malicious. Use an accept known good input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does. When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, boat may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as red or blue. Do not rely exclusively on looking for malicious or malformed inputs (i.e., do not rely on a blacklist). A blacklist is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, blacklists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright. When validating filenames, use stringent whitelists that limit the character set to be used. If feasible, only allow a single . character in the filename to avoid weaknesses such as CWE-23, and exclude directory separators such as / to avoid CWE-36. Use a whitelist of allowable file extensions, which will help to avoid CWE-434. Do not rely exclusively on a filtering mechanism that removes potentially dangerous characters. This is equivalent to a blacklist, which may be incomplete (CWE-184). For example, filtering / is insufficient protection if the filesystem also supports the use of as a directory separator. Another possible error could occur when the filtering is applied in a way that still produces dangerous data (CWE-182). For example, if ../ sequences are removed from the .../...// string in a sequential fashion, two instances of ../ would be removed from the original string, but the remaining characters would still form the ../ string.::PHASE:Architecture and Design Operation:STRATEGY:Attack Surface Reduction:EFFECTIVENESS::DESCRIPTION:Store library, include, and utility files outside of the web document root, if possible. Otherwise, store them in a separate directory and use the web server's access control capabilities to prevent attackers from directly requesting them. One common practice is to define a fixed constant in each calling program, then check for the existence of the constant in the library/include file; if the constant does not exist, then the file was directly requested, and it can exit immediately. This significantly reduces the chance of an attacker being able to bypass any protection mechanisms that are in the base program but not in the include files. It will also reduce the attack surface.::PHASE:Architecture and Design Implementation:STRATEGY:Attack Surface Reduction:EFFECTIVENESS::DESCRIPTION:Understand all the potential areas where untrusted inputs can enter your software: parameters or arguments, cookies, anything read from the network, environment variables, reverse DNS lookups, query results, request headers, URL components, e-mail, files, filenames, databases, and any external systems that provide data to the application. Remember that such inputs may be obtained indirectly through API calls. Many file inclusion problems occur because the programmer assumed that certain inputs could not be modified, especially for cookies and URL components.::PHASE:Operation:STRATEGY:Firewall:EFFECTIVENESS:Moderate:DESCRIPTION:Use an application firewall that can detect attacks against this weakness. It can be beneficial in cases in which the code cannot be fixed (because it is controlled by a third party), as an emergency prevention measure while more comprehensive software assurance measures are applied, or to provide defense in depth.::
<h5>观察到的例子</h5>::REFERENCE:CVE-2010-2076:DESCRIPTION:Product does not properly reject DTDs in SOAP messages, which allows remote attackers to read arbitrary files, send HTTP requests to intranet servers, or cause a denial of service.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-2076REFERENCE:CVE-2004-0285:DESCRIPTION:Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0285REFERENCE:CVE-2004-0030:DESCRIPTION:Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0030REFERENCE:CVE-2004-0068:DESCRIPTION:Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0068REFERENCE:CVE-2005-2157:DESCRIPTION:Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2157REFERENCE:CVE-2005-2162:DESCRIPTION:Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2162REFERENCE:CVE-2005-2198:DESCRIPTION:Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2198REFERENCE:CVE-2004-0128:DESCRIPTION:Modification of assumed-immutable variable in configuration script leads to file inclusion.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0128REFERENCE:CVE-2005-1864:DESCRIPTION:PHP file inclusion.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-1864REFERENCE:CVE-2005-1869:DESCRIPTION:PHP file inclusion.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-1869REFERENCE:CVE-2005-1870:DESCRIPTION:PHP file inclusion.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-1870REFERENCE:CVE-2005-2154:DESCRIPTION:PHP local file inclusion.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2154REFERENCE:CVE-2002-1704:DESCRIPTION:PHP remote file include.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-1704REFERENCE:CVE-2002-1707:DESCRIPTION:PHP remote file include.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-1707REFERENCE:CVE-2005-1964:DESCRIPTION:PHP remote file include.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-1964REFERENCE:CVE-2005-1681:DESCRIPTION:PHP remote file include.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-1681REFERENCE:CVE-2005-2086:DESCRIPTION:PHP remote file include.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-2086REFERENCE:CVE-2004-0127:DESCRIPTION:Directory traversal vulnerability in PHP include statement.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0127REFERENCE:CVE-2005-1971:DESCRIPTION:Directory traversal vulnerability in PHP include statement.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-1971REFERENCE:CVE-2005-3335:DESCRIPTION:PHP file inclusion issue, both remote and local; local include uses .. and %00 characters as a manipulation, but many remote file inclusion issues probably have this vector.:LINK:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3335
<h5>功能区域</h5>空
<h5>影响资源</h5>空
<h5>分类法映射</h5>空
<h5>相关的攻击模式</h5>*175：
<h5>笔记</h5>空

