# ID: 434 - 危险类型文件的无限制上传
<h5>名称</h5>危险类型文件的无限制上传
<h5>弱点抽象</h5>底座
<h5>状态</h5>草案
<h5>描述</h5>该软件允许攻击者上传或传输可在产品环境中自动处理的危险类型文件。
<h5>扩展描述</h5>空
<h5>相关的弱点</h5>*性质：子女：CWE ID：669：视图ID：1000：序数：初级：自然：子级：CWE ID：669：视图ID：1003：序号：PRIMARE：PEEROf：CWE ID：351：View ID：1000：大自然：PeerOf：CWE ID：436：View ID：1000：Nature：PeerOf：CWE ID：430：View ID：1000：
<h5>弱点规律</h5>*序号：主要：描述：当根本没有检查时，这可以是主要的。：序号：结束符：描述：这通常是在使用双扩展名(例如.php.gif)绕过正常检查时产生的。：序号：结束符：说明：这可以是客户端强制执行的结果(CWE-602)；一些产品将在Web客户端包含web脚本来检查文件名，而无需在服务器端验证。
<h5>适用的平台</h5>：：LANGUAGE NAME：ASP.NET：LANGUAGE PREVALENCE：Sometimes：：LANGUAGE NAME：PHP：LANGUAGE PREVALENCE：Often：LANGUAGE CLASS：Language-Independent：LANGUAGE PREVALENCE：Undetermined：：PARADIGN NAME：Web Based：PARADIGN PREVALENCE：Undetermined：：TECHNOLOGY NAME：Web Server：TECHNOLOGY PREVALENCE：Sometimes：：
<h5>背景细节</h5>空
<h5>替代条款</h5>*术语：不受限制的文件上载：描述：不受限制的文件上载术语用于漏洞数据库和其他地方，但不够精确。这一短语可以解释为对上载文件的大小或数量没有限制，这是一个资源消耗问题。
<h5>模式的介绍</h5>：PHASE：Implementation：DESCRIPTION：PHASE：Architecture和设计：描述：
<h5>剥削因素</h5>空
<h5>利用的可能性</h5>空
<h5>常见的后果</h5>：：SCOPE：Integrity：SCOPE：Confidentiality：SCOPE：Availability：TECHNICAL影响：执行未经授权的代码或命令：注意：完整性、保密性、可用性、执行未经授权的代码或命令，如果收件人将上传的文件解释为代码并作为代码执行，则可以执行任意代码。对于上传到Web服务器的.asp和.php扩展名尤其如此，因为这些文件类型通常被视为自动可执行文件，即使文件系统权限没有指定执行。例如，在Unix环境中，程序通常不能运行，除非设置了执行位，但是PHP程序可以由Web服务器执行，而无需在操作系统上直接调用它们。：
<h5>检测方法</h5>：：METHOD：Dynamic Analysis with Automated Results Interpretation：EFFECTIVENESS：SOAR Partial：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Cost effective for partial coverage：Web Application Scanner Web Services Scanner Database Scanners：：METHOD：Dynamic Analysis with Manual Results Interpretation：EFFECTIVENESS：SOAR Partial：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Cost effective for partial coverage：Fuzz Tester Framework-based Fuzzer：：METHOD：Manual Static Analysis-Source Code：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Focused Manual Spotcheck-Focused manual analysis of source Manual Source Code Review(not inspections)：：METHOD：Automated Static Analysis-Source Code：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Source code Weakness Analyzer Context-configured Source Code Weakness Analyzer：：METHOD：Architecture or Design Review：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Formal Methods/Correct-By-Construction Cost effective for partial coverage：Inspection(IEEE 1028 standard)(can apply to requirements，design，source code，etc.)：：
<h5>潜在的缓解措施</h5>::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:Generate a new, unique filename for an uploaded file instead of using the user-supplied filename, so that no external input is used at all.[REF-422] [REF-423]::PHASE:Architecture and Design:STRATEGY:Enforcement by Conversion:EFFECTIVENESS::DESCRIPTION:When the set of acceptable objects, such as filenames or URLs, is limited or known, create a mapping from a set of fixed input values (such as numeric IDs) to the actual filenames or URLs, and reject all other inputs.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:Consider storing the uploaded files outside of the web document root entirely. Then, use other mechanisms to deliver the files dynamically. [REF-423]::PHASE:Implementation:STRATEGY:Input Validation:EFFECTIVENESS::DESCRIPTION:Assume all input is malicious. Use an accept known good input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does. When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, boat may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as red or blue. Do not rely exclusively on looking for malicious or malformed inputs (i.e., do not rely on a blacklist). A blacklist is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, blacklists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright. For example, limiting filenames to alphanumeric characters can help to restrict the introduction of unintended file extensions.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:Define a very limited set of allowable extensions and only generate filenames that end in these extensions. Consider the possibility of XSS (CWE-79) before allowing .html or .htm file types.::PHASE:Implementation:STRATEGY:Input Validation:EFFECTIVENESS::DESCRIPTION:Ensure that only one extension is used in the filename. Some web servers, including some versions of Apache, may process files based on inner extensions so that filename.php.gif is fed to the PHP interpreter.[REF-422] [REF-423]::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:When running on a web server that supports case-insensitive filenames, perform case-insensitive evaluations of the extensions that are provided.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:Do not rely exclusively on sanity checks of file contents to ensure that the file is of the expected type and size. It may be possible for an attacker to hide code in some file segments that will still be executed by the server. For example, GIF images may contain a free-form comments field.::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:Do not rely exclusively on the MIME content type or filename attribute when determining how to render a file. Validating the MIME content type and ensuring that it matches the extension is only a partial solution.::PHASE:Architecture and Design Operation:STRATEGY:Environment Hardening:EFFECTIVENESS::DESCRIPTION:Run your code using the lowest privileges that are required to accomplish the necessary tasks [REF-76]. If possible, create isolated accounts with limited privileges that are only used for a single task. That way, a successful attack will not immediately give the attacker access to the rest of the software or its environment. For example, database applications rarely need to run as the database administrator, especially in day-to-day operations.::PHASE:Architecture and Design Operation:STRATEGY:Sandbox or Jail:EFFECTIVENESS:Limited:DESCRIPTION:Run the code in a jail or similar sandbox environment that enforces strict boundaries between the process and the operating system. This may effectively restrict which files can be accessed in a particular directory or which commands can be executed by the software. OS-level examples include the Unix chroot jail, AppArmor, and SELinux. In general, managed code may provide some protection. For example, java.io.FilePermission in the Java SecurityManager allows the software to specify restrictions on file operations. This may not be a feasible solution, and it only limits the impact to the operating system; the rest of the application may still be subject to compromise. Be careful to avoid CWE-243 and other weaknesses related to jails.::
<h5>观察到的例子</h5>：：REFERENCE：CVE-2001-0901：DESCRIPTION：Web-based mail product stores.shtml attachments that could contain SSI：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2001-0901REFERENCE：CVE-2002-1841：DESCRIPTION：PHP upload does not restrict file types：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2002-1841REFERENCE：CVE-2005-1868：DESCRIPTION：upload and execution of.php file：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2005-1868REFERENCE：CVE-2005-1881：DESCRIPTION：upload file with dangerous extension：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2005-1881REFERENCE：CVE-2005-0254：DESCRIPTION：program does not restrict file types：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2005-0254REFERENCE：CVE-2004-2262：DESCRIPTION：improper type checking of uploaded files：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2004-2262REFERENCE：CVE-2006-4558：DESCRIPTION：Double php extension leaves an active php extension in the generated filename.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2006-4558REFERENCE：CVE-2006-6994：DESCRIPTION：ASP program allows upload of.asp files by bypassing client-side checks：LINK：http：//cve.mitre.org/cgi-bin/cvekey.cgi？keyword=CVE-2006-6994REFERENCE：CVE-2005-3288：DESCRIPTION：ASP file upload：LINK：http：//cve.mitre.org/cgi-bin/cvekey.cgi？keyword=CVE-2005-3288REFERENCE：CVE-2006-2428：DESCRIPTION：ASP file upload：LINK：http：//cve.mitre.org/cgi-bin/cvekey.cgi？keyword=CVE-2006-2428
<h5>功能区域</h5>*文件处理
<h5>影响资源</h5>档案或目录：
<h5>分类法映射</h5>分类法名称：plover：Entry name：UnitedFileUpload：分类法名称：OWASP前十名2007：条目ID：A3：条目名称：恶意文件执行：映射FIT：CWE更具体：
<h5>相关的攻击模式</h5>*1：122：
<h5>笔记</h5>类型：关系：注意：这可以与不完整的黑名单/允许的白名单错误的链接关系，当产品尝试，但失败，适当限制哪些类型的文件是允许的(CWE-183，CWE-184)。这也会重叠中介体的多个解释错误，例如不移除或隔离附件的反病毒产品，以及某些可由客户端系统处理的文件扩展名。：类型：Research Gap：注意：PHP应用程序是最有针对性的，但这很可能适用于其他支持文件上载的语言以及非Web技术。ASP应用程序也演示了这个问题。：

