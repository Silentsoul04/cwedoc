# ID: 116 - 输出编码或转义不当
<h5>名称</h5>输出编码或转义不当
<h5>弱点抽象</h5>班级，等级
<h5>状态</h5>草案
<h5>描述</h5>该软件为与另一个组件通信准备结构化消息，但是数据的编码或转义要么丢失，要么做错了。因此，没有保留消息的预期结构。
<h5>扩展描述</h5>不正确的编码或转义允许攻击者更改发送到另一个组件的命令，从而插入恶意命令。大多数软件遵循特定的协议，使用结构化消息在组件之间进行通信，例如查询或命令。这些结构化消息可以包含带有元数据或控制信息的原始数据。例如，get/index.html HTTP/1.1是一个结构化消息，包含一个带有单个参数的命令(GET)(/index.html)和使用哪个协议版本的元数据(HTTP/1.1)。如果应用程序使用攻击者提供的输入来构造结构化消息，而不进行正确的编码或转义，则攻击者可以插入特殊字符，这些字符将导致将数据解释为控制信息或元数据。因此，接收输出的组件将执行错误的操作，或者以其他方式错误地解释数据。
<h5>相关的弱点</h5>*性质：CWE ID：707：视图ID：1000：序数：主：自然：ID：1003：ORDINAL：Primary：：NATURE：CanPrecede：CWE ID：707：视图ID：74：视图ID：1000：
<h5>弱点规律</h5>空
<h5>适用的平台</h5>*语言类：语言独立：语言流行率：待定：技术名称：数据库服务器：技术流行率：经常：技术名称：Web服务器：技术流行率：经常：
<h5>背景细节</h5>空
<h5>替代条款</h5>*术语：产出消毒：说明：术语：产出验证：术语：产出编码：说明：
<h5>模式的介绍</h5>*阶段：架构和Design：DESCRIPTION：PHASE：Implementation：DESCRIPTION：PHASE：Operation：DESCRIPTION：
<h5>剥削因素</h5>空
<h5>利用的可能性</h5>空
<h5>常见的后果</h5>*范围：完整性：技术影响：修改应用程序数据：注意：完整性修改应用程序数据组件之间的通信可以意想不到的方式修改。可以绕过其他安全机制执行意外命令。传入的数据可以是misinterpreted.：：SCOPE：Integrity：SCOPE：Confidentiality：SCOPE：Availability：SCOPE：Access控件：技术影响：执行未经授权的代码或命令：注意：完整性、保密性、可用性、访问控制、执行未经授权的代码或命令，组件之间的通信可以意想不到的方式进行修改。可以绕过其他安全机制执行意外命令。输入的数据可以是misinterpreted.：：SCOPE：Confidentiality：TECHNICAL影响：旁路保护机制：注意：保密旁路保护机制，组件之间的通信可以意想不到的方式修改。可以绕过其他安全机制执行意外命令。传入的数据可能会被误解。
<h5>检测方法</h5>*方法：经常可以使用自动静态分析工具检测自动化静态Analysis：EFFECTIVENESS：Moderate：DESCRIPTION：This弱点。许多现代工具使用数据流分析或基于约束的技术来最小化假阳性的数量。：方法：自动动态分析：有效性：描述：这个弱点可以使用动态工具和技术来检测，这些工具和技术使用具有多种输入的大型测试套件与软件交互，例如模糊测试(Fuzking)、健壮性测试和故障注入。该软件的操作可能会减慢，但不应变得不稳定、崩溃或产生不正确的结果。
<h5>潜在的缓解措施</h5>*阶段：架构和设计：战略：库或框架：有效性：说明：使用经过审查的库或框架，不允许出现这一弱点，或提供更容易避免这一弱点的结构。例如，考虑使用ESAPI编码控件[ref-45]或类似的工具、库或框架。这将有助于程序员以一种不容易出错的方式对输出进行编码。或者，使用内置函数，但考虑使用包装器，以防发现这些函数存在漏洞。：相位：体系结构和Design：STRATEGY：Parameterization：EFFECTIVENESS：：DESCRIPTION：If可用，使用结构化机制自动执行数据和代码之间的分离。这些机制可以自动提供相关的引用、编码和验证，而不是依赖开发人员在生成输出的每个点提供这种功能。例如，存储过程可以强制执行数据库查询结构，并减少SQL注入的可能性。：阶段：体系结构和设计Implementation：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Understand-将在其中使用数据的上下文和预期的编码。在不同组件之间传输数据时，或者在生成可以同时包含多个编码的输出(如网页或多部分邮件消息)时，这一点尤为重要。研究所有预期的通信协议和数据表示，以确定所需的编码策略。：阶段：体系结构和Design：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：In-某些情况下，当输出编码不是一个完整的解决方案时，输入验证可能是一种重要的策略。例如，您可能提供相同的输出，这些输出将由使用不同编码或表示的多个使用者处理。在其他情况下，您可能需要允许用户提供的输入包含控制信息，例如支持wiki或公告板格式的有限HTML标记。当必须满足这种类型的要求时，请使用非常严格的白名单来限制可以使用的控制序列。验证所产生的语法结构是否符合您的预期。Use your normal encoding methods for the remainder of the input.：：PHASE：Architecture and Design：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Use input validation as a defense-in-depth measure to reduce the likelihood of output encoding errors(see CWE-20).：：PHASE：Requirements：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Fully specify which encodings are required by components that will be communicating with each other.：：PHASE：Implementation：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：When exchanging data between components，ensure that both components are using the same character encoding.确保在每个接口上应用正确的编码。在协议允许时，显式设置正在使用的编码。：
<h5>观察到的例子</h5>：：REFERENCE：CVE-2008-4636：DESCRIPTION：OS command injection in backup software using shell metacharacters in a filename；correct behavior would require that this filename could not be changed.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-4636REFERENCE：CVE-2008-0769：DESCRIPTION：Web application does not set the charset when sending a page to a browser，allowing for XSS exploitation when a browser chooses an unexpected encoding.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-0769REFERENCE：CVE-2008-0005：DESCRIPTION：Program does not set the charset when sending a page to a browser，allowing for XSS exploitation when a browser chooses an unexpected encoding.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-0005REFERENCE：CVE-2008-5573：DESCRIPTION：SQLinjection via password parameter；a strong password might contain&：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5573REFERENCE：CVE-2008-3773：DESCRIPTION：Cross-site scripting in chat application via a message subject，which normally might contain&and other XSS-related characters.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-3773REFERENCE：CVE-2008-0757：DESCRIPTION：Cross-site scripting in chat application via a message，which normally might be allowed to contain arbitrary content.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-0757
<h5>功能区域</h5>空
<h5>影响资源</h5>空
<h5>分类法映射</h5>TAXONOMY NAME：WASC：ENTRY ID：22：ENTRY NAME：Improper Output Handling：TAXONOMY NAME：CERT Java Secure Coding：ENTRY ID：IDS00-J：ENTRY NAME：Sanitize untrusted data passed across a trust boundary：TAXONOMY NAME：CERT Java Secure Coding：ENTRY ID：IDS05-J：ENTRY NAME：Use a subset of ASCII for file and path names：TAXONOMY NAME：CERT Perl Secure Coding：ENTRY ID：IDS33-PL：ENTRY NAME：Sanitize untrusted data passed across a trust boundary：MAPPING FIT：Exact：：
<h5>相关的攻击模式</h5>*104：73：81：85：
<h5>笔记</h5>类型：关系：注：此弱点是与注入相关的所有弱点(CWE-74)的主要原因，因为注入的固有性质涉及违反结构化消息。：类型：关系：注：CWE-116和CWE-20有密切的关联，因为根据结构化消息的性质，适当的输入验证可以间接防止特殊字符更改结构化消息的含义。例如，通过验证一个数字ID字段应该只包含0-9个字符，程序员可以有效地防止注入攻击。但是，输入验证并不总是足够的，特别是当必须支持不太严格的数据类型时，例如自由格式文本。考虑将姓氏插入查询的SQL注入场景。名称O‘Reilly很可能通过验证步骤，因为它是英语中常见的姓氏。但是，它不能直接插入到数据库中，因为它包含“撇号”字符，需要转义或以其他方式中和。在这种情况下，去掉撇号可能会降低SQL注入的风险，但它会产生错误的行为，因为错误的名称将被记录。：type：术语表：注意：编码和转义术语的用法差别很大。例如，在一些编程语言中，术语可以互换使用，而其他语言则提供用于不同任务的API。这种重叠的用法扩展到Web，例如用于编码的转义JavaScript函数。当然，编码和转义的概念比Web早几十年。在这种情况下，CWE很难采用一致的词汇，而不会被某些群体误解。：类型：理论：注：这是一个数据/指令边界错误，在将数据边界发送到另一个控制范围之前没有充分强制执行。：类型：研究差距：虽然许多已公布的漏洞与输出编码不足有关，但强调输入验证作为一种保护机制，其根本原因很少被描述。在CVE中，重点主要放在理解良好的问题上，比如跨站点脚本和SQL注入。这种弱点可能经常出现在支持多个编码的自定义协议中，这些编码不一定可以用自动化技术检测到。

