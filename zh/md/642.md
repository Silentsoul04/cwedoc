# ID: 642 - 临界状态数据的外部控制
<h5>名称</h5>临界状态数据的外部控制
<h5>弱点抽象</h5>班级，等级
<h5>状态</h5>草案
<h5>描述</h5>该软件将其用户或软件本身的安全关键状态信息存储在一个可供未经授权的行为者访问的位置。
<h5>扩展描述</h5>如果攻击者可以在未检测到的情况下修改状态信息，则可将其用于执行未经授权的操作或访问意外资源，因为应用程序员不希望状态发生更改。状态信息可以存储在各种位置，如cookie、隐藏的web表单字段、输入参数或参数、环境变量、数据库记录、设置文件中等。所有这些位置都有可能被攻击者修改。当使用此状态信息控制安全性或确定资源使用情况时，它可能会造成漏洞。例如，应用程序可以执行身份验证，然后将状态保存在一个身份验证=true cookie中。攻击者只需创建此cookie即可绕过身份验证。
<h5>相关的弱点</h5>*性质：子女：CWE ID：668：视图ID：1000：序数：主：
<h5>弱点规律</h5>空
<h5>适用的平台</h5>*语言类：语言独立：语言流行率：待定：技术名称：Web服务器：技术流行率：经常：
<h5>背景细节</h5>空
<h5>替代条款</h5>空
<h5>模式的介绍</h5>*阶段：架构和Design：DESCRIPTION：PHASE：Implementation：DESCRIPTION：
<h5>剥削因素</h5>空
<h5>利用的可能性</h5>空
<h5>常见的后果</h5>*范围：访问控制：技术影响：绕过保护机制获得特权或假定身份：注意：访问控制旁路保护机制获得特权或假定身份攻击者可能以恶意方式修改状态。如果状态与用户拥有的权限或身份验证级别相关，则状态修改可能允许用户绕过身份验证或提升权限。：范围：机密性：技术影响：读取应用程序数据：注意：机密性读取应用程序数据状态变量可能包含客户端不应该知道的敏感信息。：范围：可用性：技术影响：注意：可用性：DoS：Availability DoS：崩溃、退出，或者通过修改状态变量重新启动，攻击者可能会违反应用程序的状态变量。对状态内容的期望，由于意外错误条件导致拒绝服务。：
<h5>检测方法</h5>空
<h5>潜在的缓解措施</h5>::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:Understand all the potential locations that are accessible to attackers. For example, some programmers assume that cookies and hidden form fields cannot be modified by an attacker, or they may not consider that environment variables can be modified before a privileged program is invoked.::PHASE:Architecture and Design:STRATEGY:Attack Surface Reduction:EFFECTIVENESS::DESCRIPTION:Store state information and sensitive data on the server side only. Ensure that the system definitively and unambiguously keeps track of its own state and user state and has rules defined for legitimate state transitions. Do not allow any application user to affect state directly in any way other than through legitimate actions leading to state transitions. If information must be stored on the client, do not do so without encryption and integrity checking, or otherwise having a mechanism on the server side to catch tampering. Use a message authentication code (MAC) algorithm, such as Hash Message Authentication Code (HMAC) [REF-529]. Apply this against the state or sensitive data that you has to be exposed, which can guarantee the integrity of the data - i.e., that the data has not been modified. Ensure that a strong hash function is used (CWE-328).::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:Store state information on the server side only. Ensure that the system definitively and unambiguously keeps track of its own state and user state and has rules defined for legitimate state transitions. Do not allow any application user to affect state directly in any way other than through legitimate actions leading to state transitions.::PHASE:Architecture and Design:STRATEGY:Libraries or Frameworks:EFFECTIVENESS::DESCRIPTION:Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid. With a stateless protocol such as HTTP, use some frameworks can maintain the state for you. Examples include ASP.NET View State and the OWASP ESAPI Session Management feature. Be careful of language features that provide state support, since these might be provided as a convenience to the programmer and may not be considering security.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.::PHASE:Operation Implementation:STRATEGY:Environment Hardening:EFFECTIVENESS::DESCRIPTION:When using PHP, configure the application so that it does not use register_globals. During implementation, develop the application so that it does not rely on this feature, but be wary of implementing a register_globals emulation that is subject to weaknesses such as CWE-95, CWE-621, and similar issues.::PHASE:Testing:STRATEGY::EFFECTIVENESS::DESCRIPTION:Use automated static analysis tools that target this type of weakness. Many modern techniques use data flow analysis to minimize the number of false positives. This is not a perfect solution, since 100% accuracy and coverage are not feasible.::PHASE:Testing:STRATEGY::EFFECTIVENESS::DESCRIPTION:Use dynamic tools and techniques that interact with the software using large test suites with many diverse inputs, such as fuzz testing (fuzzing), robustness testing, and fault injection. The software's operation may slow down, but it should not become unstable, crash, or generate incorrect results.::PHASE:Testing:STRATEGY::EFFECTIVENESS::DESCRIPTION:Use tools and techniques that require manual (human) analysis, such as penetration testing, threat modeling, and interactive tools that allow the tester to record and modify an active session. These may be more effective than strictly automated techniques. This is especially the case with weaknesses that are related to design and business rules.::
<h5>观察到的例子</h5>：：REFERENCE：CVE-2005-2428：DESCRIPTION：Mail client stores password hashes for unrelated accounts in a hidden form field.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2005-2428REFERENCE：CVE-2008-0306：DESCRIPTION：Privileged program trusts user-specified environment variable to modify critical configuration settings.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-0306REFERENCE：CVE-1999-0073：DESCRIPTION：Telnet daemon allows remote clients to specify critical environment variables for the server，leading to code execution.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-1999-0073REFERENCE：CVE-2007-4432：DESCRIPTION：Untrusted search path vulnerability through modified LD_LIBRARY_PATH environment variable.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2007-4432REFERENCE：CVE-2006-7191：DESCRIPTION：Untrusted search path vulnerability through modified LD_LIBRARY_PATH environment variable.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2006-7191REFERENCE：CVE-2008-5738：DESCRIPTION：Calendar application allows bypass of authentication by setting a certain cookie value to 1.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5738REFERENCE：CVE-2008-5642：DESCRIPTION：Setting of alanguage preference in a cookie enables path traversal attack.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5642REFERENCE：CVE-2008-5125：DESCRIPTION：Application allows admin privileges by setting a cookie value to admin.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5125REFERENCE：CVE-2008-5065：DESCRIPTION：Application allows admin privileges by setting a cookie value to admin.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5065REFERENCE：CVE-2008-4752：DESCRIPTION：Application allows admin privileges by setting a cookie value to admin.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-4752REFERENCE：CVE-2000-0102：DESCRIPTION：Shopping cart allows price modification via hidden form field.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2000-0102REFERENCE：CVE-2000-0253：DESCRIPTION：Shopping cart allows price modification via hidden form field.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2000-0253REFERENCE：CVE-2008-1319：DESCRIPTION：Server allows client to specify the search path，which can be modified to point to a program that the client has uploaded.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-1319
<h5>功能区域</h5>空
<h5>影响资源</h5>空
<h5>分类法映射</h5>分类名称：软件故障模式：条目ID：SFP 23：条目名称：公开数据：
<h5>相关的攻击模式</h5>*21：31：
<h5>笔记</h5>空

