# ID: 73 - 文件名或路径的外部控制
<h5>名称</h5>文件名或路径的外部控制
<h5>弱点抽象</h5>班级，等级
<h5>状态</h5>草案
<h5>描述</h5>该软件允许用户输入控制或影响文件系统操作中使用的路径或文件名。
<h5>扩展描述</h5>这允许攻击者访问或修改对应用程序至关重要的系统文件或其他文件。当满足以下两个条件时，就会发生路径操作错误：1。攻击者可以指定在文件系统上的操作中使用的路径。2.通过指定资源，攻击者获得了不允许的功能。例如，程序可能使攻击者能够覆盖指定的文件或使用攻击者控制的配置运行。
<h5>相关的弱点</h5>：：NATURE：ChildOf：CWE ID：642：VIEW ID：1000：ORDINAL：Primary：：NATURE：ChildOf：CWE ID：610：VIEW ID：1000：：NATURE：ChildOf：CWE ID：20：VIEW ID：700：ORDINAL：Primary：：NATURE：ChildOf：CWE ID：20：VIEW ID：699：ORDINAL：Primary：：NATURE：CanPrecede：CWE ID：22：VIEW ID：1000：：NATURE：CanPrecede：CWE ID：41：VIEW ID：1000：：NATURE：CanPrecede：CWE ID：98：VIEW ID：1000：：NATURE：CanPrecede：CWE ID：434：VIEW ID：1000：：NATURE：CanPrecede：CWE ID：59：VIEW ID：1000：：
<h5>弱点规律</h5>*序号：主要：说明：
<h5>适用的平台</h5>*语言类：语文独立：语文流行率：操作系统类：Unix：操作系统流行率：操作系统类：Windows：操作系统流行率：操作系统类：MacOS：操作系统流行率：经常：
<h5>背景细节</h5>空
<h5>替代条款</h5>空
<h5>模式的介绍</h5>*阶段：架构和Design：DESCRIPTION：PHASE：Implementation：DESCRIPTION：PHASE：Operation：DESCRIPTION：
<h5>剥削因素</h5>空
<h5>利用的可能性</h5>空
<h5>常见的后果</h5>：：SCOPE：Integrity：SCOPE：Confidentiality：TECHNICAL影响：读取文件或目录、修改文件或目录：注意：完整性、机密性、读取文件或目录、修改文件或目录，应用程序可以对意外文件进行操作。当目标文件名无法通过attacker.：：SCOPE：Integrity：SCOPE：Confidentiality：SCOPE：Availability：TECHNICAL影响直接读取时违反机密性：修改文件或目录、执行未经授权的代码或命令：注意：完整性、机密性、可用性、修改文件或目录、执行未经授权的代码或应用程序可以对意外文件进行操作的命令。如果文件名是为程序或其他形式的可执行代码编写的，则这可能违反完整性。：范围：可用性：技术影响：DoS：崩溃、退出或重新启动DoS：资源消耗(其他)：注意：可用性DoS：崩溃、退出或重新启动DoS：资源消耗(其他)应用程序可以对意外文件进行操作。如果攻击者指定应用程序修改的意外文件，则可能会违反可用性。如果攻击者指定了一个大文件的文件名，或者指向一个特殊的设备或一个没有应用程序所期望的格式的文件，那么可用性也会受到影响。：
<h5>检测方法</h5>*方法：自动静态分析：有效性：描述：文件名的外部控制或影响经常可以使用自动静态分析来检测，该分析对软件中的数据流进行建模。自动静态分析可能无法识别何时执行适当的输入验证，从而导致误报-即不产生任何安全后果或需要进行任何代码更改的警告：
<h5>潜在的缓解措施</h5>::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:When the set of filenames is limited or known, create a mapping from a set of fixed input values (such as numeric IDs) to the actual filenames, and reject all other inputs. For example, ID 1 could map to inbox.txt and ID 2 could map to profile.txt. Features such as the ESAPI AccessReferenceMap provide this capability.::PHASE:Architecture and Design Operation:STRATEGY::EFFECTIVENESS::DESCRIPTION:Run your code in a jail or similar sandbox environment that enforces strict boundaries between the process and the operating system. This may effectively restrict all access to files within a particular directory. Examples include the Unix chroot jail and AppArmor. In general, managed code may provide some protection. This may not be a feasible solution, and it only limits the impact to the operating system; the rest of your application may still be subject to compromise. Be careful to avoid CWE-243 and other weaknesses related to jails.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.::PHASE:Implementation:STRATEGY:Input Validation:EFFECTIVENESS::DESCRIPTION:Assume all input is malicious. Use an accept known good input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does. When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, boat may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as red or blue. Do not rely exclusively on looking for malicious or malformed inputs (i.e., do not rely on a blacklist). A blacklist is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, blacklists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright. When validating filenames, use stringent whitelists that limit the character set to be used. If feasible, only allow a single . character in the filename to avoid weaknesses such as CWE-23, and exclude directory separators such as / to avoid CWE-36. Use a whitelist of allowable file extensions, which will help to avoid CWE-434. Do not rely exclusively on a filtering mechanism that removes potentially dangerous characters. This is equivalent to a blacklist, which may be incomplete (CWE-184). For example, filtering / is insufficient protection if the filesystem also supports the use of as a directory separator. Another possible error could occur when the filtering is applied in a way that still produces dangerous data (CWE-182). For example, if ../ sequences are removed from the .../...// string in a sequential fashion, two instances of ../ would be removed from the original string, but the remaining characters would still form the ../ string.::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:Use a built-in path canonicalization function (such as realpath() in C) that produces the canonical version of the pathname, which effectively removes .. sequences and symbolic links (CWE-23, CWE-59).::PHASE:Installation Operation:STRATEGY::EFFECTIVENESS::DESCRIPTION:Use OS-level permissions and run as a low-privileged user to limit the scope of any successful attack.::PHASE:Operation Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:If you are using PHP, configure your application so that it does not use register_globals. During implementation, develop your application so that it does not rely on this feature, but be wary of implementing a register_globals emulation that is subject to weaknesses such as CWE-95, CWE-621, and similar issues.::PHASE:Testing:STRATEGY::EFFECTIVENESS::DESCRIPTION:Use automated static analysis tools that target this type of weakness. Many modern techniques use data flow analysis to minimize the number of false positives. This is not a perfect solution, since 100% accuracy and coverage are not feasible.::PHASE:Testing:STRATEGY::EFFECTIVENESS::DESCRIPTION:Use dynamic tools and techniques that interact with the software using large test suites with many diverse inputs, such as fuzz testing (fuzzing), robustness testing, and fault injection. The software's operation may slow down, but it should not become unstable, crash, or generate incorrect results.::PHASE:Testing:STRATEGY::EFFECTIVENESS::DESCRIPTION:Use tools and techniques that require manual (human) analysis, such as penetration testing, threat modeling, and interactive tools that allow the tester to record and modify an active session. These may be more effective than strictly automated techniques. This is especially the case with weaknesses that are related to design and business rules.::
<h5>观察到的例子</h5>：：REFERENCE：CVE-2008-5748：DESCRIPTION：Chain：external control of values for user‘s desired language and theme enables path traversal.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5748REFERENCE：CVE-2008-5764：DESCRIPTION：Chain：external control of user’s target language enables remote file inclusion.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5764
<h5>功能区域</h5>空
<h5>影响资源</h5>空
<h5>分类法映射</h5>分类名称：7有害王国：条目名称：路径操作：分类法名称：软件故障模式：条目ID：SFP 16：条目名称：路径遍历：
<h5>相关的攻击模式</h5>*13：267：64：72：76：78：79：80：
<h5>笔记</h5>类型：关系：注意：文件名的外部控制可以是与其他文件相关的弱点的链中的主要链接，如CanPrecode关系中所示。这是因为软件系统将文件用于许多不同的用途：执行程序、加载代码库、存储应用程序数据、存储配置设置、记录临时数据、充当信号或信号到其他进程等。然而，这些弱点并不总是需要外部控制。例如，链接跟踪缺陷(CWE-59)通常包含攻击者根本无法控制的路径名。外部控制可以由其他问题产生。例如，在PHP应用程序中，寄存器_globals设置允许攻击者修改程序员认为不可变的变量，从而启用文件包含(CWE-98)和路径遍历(CWE-22)。使用过多的权限(CWE-250)操作可能允许攻击者指定一个输入文件名，攻击者不能直接读取该文件名，但特权程序可以访问该文件名。缓冲区溢出(CWE-119)可能使攻击者控制与路径名称相关但攻击者不能直接修改的附近内存位置。：

