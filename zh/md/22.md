# ID: 22 - 路径名对受限目录的不当限制(“路径遍历”)
<h5>名称</h5>路径名对受限目录的不当限制(“路径遍历”)
<h5>弱点抽象</h5>班级，等级
<h5>状态</h5>草案
<h5>描述</h5>该软件使用外部输入构造路径名，该路径名用于标识位于受限制父目录下的文件或目录，但该软件没有正确地中和路径名中的特殊元素，这些元素可能导致路径名解析到受限目录之外的位置。
<h5>扩展描述</h5>许多文件操作都是在受限制的目录中进行的。通过使用特殊的元素(如.和/分隔符)，攻击者可以在受限位置之外逃离以访问系统其他位置的文件或目录。最常见的特殊元素之一是./序列，在大多数现代操作系统中，它被解释为当前位置的父目录。这称为相对路径遍历。路径遍历还包括绝对路径名的使用，例如/usr/local/bin，这在访问意外文件时也很有用。这称为绝对路径遍历。在许多编程语言中，注入空字节(0或NUL)可能允许攻击者截断生成的文件名以扩大攻击范围。例如，软件可能将.txt添加到任何路径名中，从而限制了攻击者的文本文件，但空注入可以有效地消除这一限制。
<h5>相关的弱点</h5>*性质：子女：CWE ID：706：视图ID：1000：序数：初级：自然：子女：CWE ID：668：视图ID：1000：
<h5>弱点规律</h5>：：ORDINALITY：Primary：DESCRIPTION：ORDINALITY：Resultant：DESCRIPTION：
<h5>适用的平台</h5>*语言类：语言-独立：语言普及率：未定：
<h5>背景细节</h5>空
<h5>替代条款</h5>*术语：目录遍历：术语：路径遍历：描述：路径遍历优于目录遍历，但这两个术语都以攻击为中心。
<h5>模式的介绍</h5>*阶段：架构和Design：DESCRIPTION：PHASE：Implementation：DESCRIPTION：
<h5>剥削因素</h5>空
<h5>利用的可能性</h5>空
<h5>常见的后果</h5>：：SCOPE：Integrity：SCOPE：Confidentiality：SCOPE：Availability：TECHNICAL影响：执行未经授权的代码或命令：注意：完整性机密性可用性执行未经授权的代码或命令攻击者可能能够创建或覆盖用于执行代码的关键文件，如程序或库。：范围：完整性：技术影响：修改文件或目录：注意：完整性修改文件或目录攻击者可能能够覆盖或创建关键文件，如程序、库或重要数据。如果目标文件用于安全机制，则攻击者可以绕过该机制。例如，在密码文件末尾追加一个新帐户可能允许攻击者绕过authentication.：：SCOPE：Confidentiality：TECHNICAL影响：读取文件或目录：注意：机密性读取文件或目录攻击者可能能够读取意外文件的内容并公开敏感数据。如果目标文件用于安全机制，则攻击者可以绕过该机制。例如，通过读取密码文件，攻击者可以进行强行密码猜测攻击，以便侵入系统上的帐户。：范围：可用性：技术影响：DoS：崩溃、退出或重新启动：注意：可用性DoS：崩溃、退出或重新启动攻击者可能能够覆盖、删除或损坏程序、库或重要数据等意外的关键文件。这可能会使软件根本无法工作，在认证等保护机制的情况下，软件有可能锁定软件的每个用户。
<h5>检测方法</h5>*方法：自动静态Analysis：EFFECTIVENESS：High：DESCRIPTION：Automated技术可以找到路径遍历弱点存在的领域。但是，可能需要进行调优或自定义，以删除或取消优先路径遍历问题，这些问题只有软件管理员或其他特权用户才能利用，因此可能有效的行为，或最坏的错误，而不是漏洞。：方法：手动静态Analysis：EFFECTIVENESS：High：DESCRIPTION：Manual白盒技术可能能够提供足够的代码覆盖率，并减少错误的出现，如果所有文件访问操作都能在有限的时间内进行评估的话。constraints.：：METHOD：Automated Static Analysis-Binary or Bytecode：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Bytecode Weakness Analysis-including disassembler+source code weakness analysis Cost effective for partial coverage：Binary Weakness Analysis-including disassembler+source code weakness analysis：：METHOD：Manual Static Analysis-Binary or Bytecode：EFFECTIVENESS：SOAR Partial：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Cost effective for partial coverage：Binary/Bytecodedisassembler-then use manual analysis for vulnerabilities&anomalies：：METHOD：Dynamic Analysis with Automated Results Interpretation：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Web Application Scanner Web Services Scanner Database Scanners：：METHOD：Dynamic Analysis with Manual Results Interpretation：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Fuzz Tester Framework-based Fuzzer：：METHOD：Manual Static Analysis-Source Code：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Manual Source Code Review(not inspections)Cost effective for partial coverage：Focused Manual Spotcheck-Focused manual analysis of source：：METHOD：Automated Static Analysis-Source Code：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Source code Weakness Analyzer Context-configured Source Code Weakness Analyzer：：METHOD：Architecture or Design Review：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Formal Methods/Correct-By-Construction Cost effective对于部分覆盖：检查(IEEE 1028标准)(可适用于需求、设计、源代码等)：
<h5>潜在的缓解措施</h5>::PHASE:Implementation:STRATEGY:Input Validation:EFFECTIVENESS::DESCRIPTION:Assume all input is malicious. Use an accept known good input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does. When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, boat may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as red or blue. Do not rely exclusively on looking for malicious or malformed inputs (i.e., do not rely on a blacklist). A blacklist is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, blacklists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright. When validating filenames, use stringent whitelists that limit the character set to be used. If feasible, only allow a single . character in the filename to avoid weaknesses such as CWE-23, and exclude directory separators such as / to avoid CWE-36. Use a whitelist of allowable file extensions, which will help to avoid CWE-434. Do not rely exclusively on a filtering mechanism that removes potentially dangerous characters. This is equivalent to a blacklist, which may be incomplete (CWE-184). For example, filtering / is insufficient protection if the filesystem also supports the use of as a directory separator. Another possible error could occur when the filtering is applied in a way that still produces dangerous data (CWE-182). For example, if ../ sequences are removed from the .../...// string in a sequential fashion, two instances of ../ would be removed from the original string, but the remaining characters would still form the ../ string.::PHASE:Architecture and Design:STRATEGY::EFFECTIVENESS::DESCRIPTION:For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.::PHASE:Implementation:STRATEGY:Input Validation:EFFECTIVENESS::DESCRIPTION:Inputs should be decoded and canonicalized to the application's current internal representation before being validated (CWE-180). Make sure that the application does not decode the same input twice (CWE-174). Such errors could be used to bypass whitelist validation schemes by introducing dangerous inputs after they have been checked. Use a built-in path canonicalization function (such as realpath() in C) that produces the canonical version of the pathname, which effectively removes .. sequences and symbolic links (CWE-23, CWE-59). This includes: realpath() in C getCanonicalPath() in Java GetFullPath() in ASP.NET realpath() or abs_path() in Perl realpath() in PHP::PHASE:Architecture and Design:STRATEGY:Libraries or Frameworks:EFFECTIVENESS::DESCRIPTION:Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.::PHASE:Operation:STRATEGY:Firewall:EFFECTIVENESS:Moderate:DESCRIPTION:Use an application firewall that can detect attacks against this weakness. It can be beneficial in cases in which the code cannot be fixed (because it is controlled by a third party), as an emergency prevention measure while more comprehensive software assurance measures are applied, or to provide defense in depth.::PHASE:Architecture and Design Operation:STRATEGY:Environment Hardening:EFFECTIVENESS::DESCRIPTION:Run your code using the lowest privileges that are required to accomplish the necessary tasks [REF-76]. If possible, create isolated accounts with limited privileges that are only used for a single task. That way, a successful attack will not immediately give the attacker access to the rest of the software or its environment. For example, database applications rarely need to run as the database administrator, especially in day-to-day operations.::PHASE:Architecture and Design:STRATEGY:Enforcement by Conversion:EFFECTIVENESS::DESCRIPTION:When the set of acceptable objects, such as filenames or URLs, is limited or known, create a mapping from a set of fixed input values (such as numeric IDs) to the actual filenames or URLs, and reject all other inputs. For example, ID 1 could map to inbox.txt and ID 2 could map to profile.txt. Features such as the ESAPI AccessReferenceMap [REF-185] provide this capability.::PHASE:Architecture and Design Operation:STRATEGY:Sandbox or Jail:EFFECTIVENESS:Limited:DESCRIPTION:Run the code in a jail or similar sandbox environment that enforces strict boundaries between the process and the operating system. This may effectively restrict which files can be accessed in a particular directory or which commands can be executed by the software. OS-level examples include the Unix chroot jail, AppArmor, and SELinux. In general, managed code may provide some protection. For example, java.io.FilePermission in the Java SecurityManager allows the software to specify restrictions on file operations. This may not be a feasible solution, and it only limits the impact to the operating system; the rest of the application may still be subject to compromise. Be careful to avoid CWE-243 and other weaknesses related to jails.::PHASE:Architecture and Design Operation:STRATEGY:Attack Surface Reduction:EFFECTIVENESS::DESCRIPTION:Store library, include, and utility files outside of the web document root, if possible. Otherwise, store them in a separate directory and use the web server's access control capabilities to prevent attackers from directly requesting them. One common practice is to define a fixed constant in each calling program, then check for the existence of the constant in the library/include file; if the constant does not exist, then the file was directly requested, and it can exit immediately. This significantly reduces the chance of an attacker being able to bypass any protection mechanisms that are in the base program but not in the include files. It will also reduce the attack surface.::PHASE:Implementation:STRATEGY::EFFECTIVENESS::DESCRIPTION:Ensure that error messages only contain minimal details that are useful to the intended audience, and nobody else. The messages need to strike the balance between being too cryptic and not being cryptic enough. They should not necessarily reveal the methods that were used to determine the error. Such detailed information can be used to refine the original attack to increase the chances of success. If errors must be tracked in some detail, capture them in log messages - but consider what could occur if the log messages can be viewed by attackers. Avoid recording highly sensitive information such as passwords in any form. Avoid inconsistent messaging that might accidentally tip off an attacker about internal state, such as whether a username is valid or not. In the context of path traversal, error messages which disclose path information can help attackers craft the appropriate attack strings to move through the file system hierarchy.::PHASE:Operation Implementation:STRATEGY:Environment Hardening:EFFECTIVENESS::DESCRIPTION:When using PHP, configure the application so that it does not use register_globals. During implementation, develop the application so that it does not rely on this feature, but be wary of implementing a register_globals emulation that is subject to weaknesses such as CWE-95, CWE-621, and similar issues.::
<h5>观察到的例子</h5>：：REFERENCE：CVE-2010-0467：DESCRIPTION：Newsletter module allows reading arbitrary files using../sequences.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2010-0467REFERENCE：CVE-2009-4194：DESCRIPTION：FTP server allows deletion of arbitrary files using..in the DELE command.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-4194REFERENCE：CVE-2009-4053：DESCRIPTION：FTP server allows creation of arbitrary directories using..in the MKD command.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-4053REFERENCE：CVE-2009-0244：DESCRIPTION：OBEX FTP service for a Bluetooth device allows listing of directories，and creation or reading of files using..sequences.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-0244REFERENCE：CVE-2009-4013：DESCRIPTION：Software package maintenance program allows overwriting arbitrary files using../sequences.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-4013REFERENCE：CVE-2009-4449：DESCRIPTION：Bulletin board allows attackers to determine the existence offiles using the avatar.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-4449REFERENCE：CVE-2009-4581：DESCRIPTION：PHP program allows arbitrary code execution using..in filenames that are fed to the include()function.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-4581REFERENCE：CVE-2010-0012：DESCRIPTION：Overwrite of files using a..in a Torrent file.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2010-0012REFERENCE：CVE-2010-0013：DESCRIPTION：Chat program allows overwriting files using a custom smiley request.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2010-0013REFERENCE：CVE-2008-5748：DESCRIPTION：Chain：external control of values for user‘s desired language and theme enables path traversal.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5748REFERENCE：CVE-2009-1936：DESCRIPTION：Chain：library file sends a redirect if it is directly requested but continues to execute，allowing remote file inclusion and path traversal.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-1936
<h5>功能区域</h5>*文件处理
<h5>影响资源</h5>档案或目录：
<h5>分类法映射</h5>TAXONOMY NAME：PLOVER：ENTRY NAME：Path Traversal：TAXONOMY NAME：OWASP Top Ten 2007：ENTRY ID：A4：ENTRY NAME：Insecure Direct Object Reference：MAPPING FIT：CWE More Specific：TAXONOMY NAME：OWASP Top Ten 2004：ENTRY ID：A2：ENTRY NAME：Broken Access Control：MAPPING FIT：CWE More Specific：TAXONOMY NAME：CERT C Secure Coding：ENTRY ID：FIO02-C：ENTRY NAME：Canonicalize path names originating from untrusted sources：TAXONOMY NAME：CERT Perl Secure Coding：ENTRY ID：IDS00-PL：ENTRY NAME：Canonicalize path names before validating them：MAPPING FIT：Exact：TAXONOMY NAME：WASC：ENTRY ID：33：ENTRY NAME：Path Traversal：TAXONOMY NAME：Software Fault Patterns：ENTRY ID：SFP16：ENTRY NAME：Path Traversal：：
<h5>相关的攻击模式</h5>*126：213：23：64：76：78：79：
<h5>笔记</h5>类型：关系：注意：路径名称等价可以看作是一种规范化错误。：类型：关系：注：一些路径名称等价问题与目录遍历没有直接关系，而是用于绕过安全检查，以确定攻击者是否可以访问文件/目录(例如，文件名的尾随/对文件名的跟踪/对文件名的访问可以绕过访问规则，从而导致服务器在通常情况下不会提供文件)：类型：术语：注释：与其他弱点、术语一样。通常是基于所使用的操作类型，而不是潜在的弱点。有些人使用目录遍历仅指注入.和等效序列，其具体含义是遍历目录。其他变体，如绝对路径名和驱动器字母，具有目录遍历的*效果*，但有些人可能不会这样称呼它，因为它不涉及.或等效。：类型：Research Gap：注意：许多路径遍历攻击的变体可能没有得到充分的研究-关于根本原因的研究。CWE-790和CWE-182开始弥补这一差距的一部分。：类型：研究差距：注：对漏洞的不完整诊断或报告可能使人难以知道哪种变种受到影响。例如，研究人员可能会说.是易受攻击的，而不是测试./这也可能是脆弱的。目录分隔符(/，等)和数字(例如.)的任何组合都可以产生唯一的变体；例如，没有列出/./变量(CVE-2004-0325)。请参阅此条目的子级和较低级别的后代。：

