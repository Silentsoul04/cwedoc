# ID: 362 - 使用共享资源与不正确的同步(“种族条件”)并发执行
<h5>名称</h5>使用共享资源与不正确的同步(“种族条件”)并发执行
<h5>弱点抽象</h5>班级，等级
<h5>状态</h5>草案
<h5>描述</h5>该程序包含一个可以与其他代码并发运行的代码序列，并且该代码序列需要对共享资源的临时独占访问，但是存在一个时间窗口，其中共享资源可以被并发操作的另一个代码序列修改。
<h5>扩展描述</h5>当预期的同步处于安全关键代码(例如记录用户是否经过身份验证)或修改不受外部人员影响的重要状态信息时，这可能会产生安全影响。竞争条件发生在并发环境中，实际上是代码序列的属性。根据上下文，代码序列可能以函数调用、少量指令、一系列程序调用等形式出现。竞争条件违反了这些属性，这些属性是密切相关的：排他性-赋予代码序列对共享资源的独占访问权，也就是说，在原始序列完成执行之前，任何其他代码序列都不能修改共享资源的属性。原子性-代码序列是行为原子的，也就是说，任何其他线程或进程都不能对同一资源并发执行相同的指令序列(或子集)。当干扰代码序列仍然可以访问共享资源时，存在竞争条件，这违反了独占性。程序员可能会假设某些代码序列执行得太快，不会受到干扰代码序列的影响；否则，这就违反了原子性。例如，单个x+语句可能在代码层显示为原子，但实际上在指令层是非原子的，因为它涉及读取(x的原始值)，然后是计算(x+1)，然后是写(将结果保存到x)。干扰代码序列可以是可信的，也可以是不可信的。受信任的干扰代码序列发生在程序中；攻击者不能修改它，只能间接调用它。不可信的干扰代码序列可以由攻击者直接编写，并且通常是易受攻击程序的外部代码序列。
<h5>相关的弱点</h5>*性质：子女：CWE ID：691：视图ID：1000：序数：主：
<h5>弱点规律</h5>空
<h5>适用的平台</h5>：：LANGUAGE NAME：C：LANGUAGE PREVALENCE：Sometimes：：LANGUAGE NAME：C++：LANGUAGE PREVALENCE：Sometimes：：LANGUAGE NAME：Java：LANGUAGE PREVALENCE：Sometimes：LANGUAGE CLASS：Language-Independent：LANGUAGE PREVALENCE：Undetermined：：PARADIGN NAME：Concurrent Systems Operating on Shared Resources：PARADIGN PREVALENCE：Often：：
<h5>背景细节</h5>空
<h5>替代条款</h5>空
<h5>模式的介绍</h5>*阶段：架构和Design：DESCRIPTION：PHASE：Implementation：DESCRIPTION：
<h5>剥削因素</h5>空
<h5>利用的可能性</h5>空
<h5>常见的后果</h5>：：SCOPE：Availability：TECHNICAL IMPACT：DoS：Resource Consumption(CPU)DoS：Resource Consumption(Memory)DoS：Resource Consumption(Other)：NOTE：Availability DoS：Resource Consumption(CPU)DoS：Resource Consumption(Memory)DoS：Resource Consumption(Other)When a race condition makes it possible to bypass a resource cleanup routine or trigger multiple initialization routines，it may lead to resource exhaustion(CWE-400).：：SCOPE：Availability：TECHNICAL IMPACT：DoS：Crash，Exit，or Restart DoS：Instability：NOTE：Availability DoS：Crash，Exit，or Restart DoS：Instability When a race condition allows multiple控制流同时访问资源，它可能导致程序进入意外状态，可能导致crash.：：SCOPE：Confidentiality：SCOPE：Integrity：TECHNICAL影响：读取文件或目录读取应用程序数据：注意：机密完整性读取文件或目录读取应用程序数据时，当竞争条件与可预测的资源名称和松散权限相结合时，攻击者可能会覆盖或访问机密数据(CWE-59)：
<h5>检测方法</h5>*方法：黑匣子：有效性：描述：黑匣子方法可以通过多个同时连接等方法识别种族状况的证据，这可能导致软件变得不稳定或崩溃。However，race conditions with very narrow timing windows would not be detectable.：：METHOD：White Box：EFFECTIVENESS：：DESCRIPTION：Common idioms are detectable in white box analysis，such as time-of-check-time-of-use(TOCTOU)file operations(CWE-367)，or double-checked locking(CWE-609).：：METHOD：Automated Dynamic Analysis：EFFECTIVENESS：Moderate：DESCRIPTION：This weakness can be detected using dynamic tools and techniques that interact with the software using large test suites with many diverse inputs，such as fuzz testing(fuzzing)，robustness testing，and fault injection.软件的运行可能会减慢，但不应该变得不稳定，崩溃，或产生不正确的结果。通过从大量线程或进程同时调用软件，可以通过压力测试检测竞争条件，并寻找任何意外行为的证据。在相关代码语句之间插入断点或延迟，以人为地扩展争用窗口，以便更容易检测。：方法：自动静态分析-二进制或Bytecode：EFFECTIVENESS：High：DESCRIPTION：According以快速上升，以下检测技术可能有用：高成本效益：字节码弱点分析-包括反汇编程序+部分覆盖的成本效益源代码弱点分析：二进制弱点分析-包括反汇编程序+源代码弱点分析：方法：动态分析Automated Results Interpretation：EFFECTIVENESS：SOAR Partial：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Cost effective for partial coverage：Web Application Scanner Web Services Scanner Database Scanners：：METHOD：Dynamic Analysis with Manual Results Interpretation：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Framework-based Fuzzer Cost effective for partial coverage：Fuzz Tester Monitored Virtual Environment-run potentially malicious code in sandbox/wrapper/virtual machine，see if itdoes anything suspicious：：METHOD：Manual Static Analysis-Source Code：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Manual Source Code Review(not inspections)Cost effective for partial coverage：Focused Manual Spotcheck-Focused manual analysis of source：：METHOD：Automated Static Analysis-Source Code：EFFECTIVENESS：High：DESCRIPTION：According to SOAR，the following detection techniques may be useful：Highly cost effective：Source code Weakness Analyzer Context-configured Source Code Weakness Analyzer：：METHOD：Architecture or Design Review：EFFECTIVENESS：High：DESCRIPTION：According toSOAR，下列检测技术可能是有用的：高成本效益：形式方法/对部分覆盖率有效的建筑成本校正：检查(IEEE 1028标准)(可适用于需求、设计、源代码等)：
<h5>潜在的缓解措施</h5>阶段：支持它的体系结构和Design：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：In语言，使用同步原语。只对关键代码进行包装，以尽量减少对性能的影响。：阶段：体系结构和Design：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Use线程安全功能，例如Spring中的数据访问抽象。：阶段：体系结构和Design：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Minimize共享资源的使用，以便尽可能地从控制流中删除复杂性，并减少意外情况发生的可能性。此外，这将尽量减少所需的同步量，甚至可能有助于降低拒绝服务的可能性，在这种情况下，攻击者可以使用多线程反复触发关键部分(CWE-400).：：PHASE：Implementation：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：When，并对共享变量进行操作，只对共享变量使用线程安全的functions.：：PHASE：Implementation：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Use原子操作。要警惕像x+这样的看似无辜的构造。This may appear atomic at the code layer，but it is actually non-atomic at the instruction layer，since it involves a read，followed by a computation，followed by a write.：：PHASE：Implementation：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Use a mutex if available，but be sure to avoid related weaknesses such as CWE-412.：：PHASE：Implementation：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Avoid double-checked locking(CWE-609)and other implementation errors that arise when trying to avoid the overhead of synchronization.：：PHASE：Implementation：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Disable interrupts or signals over critical parts of the code，但也要确保代码不会进入大型或无限的loop.：：PHASE：Implementation：STRATEGY：：EFFECTIVENESS：：DESCRIPTION：Use，即关键变量的易失性类型修饰符，以避免意外的编译器优化或重新排序。这不一定解决同步问题，但它可以帮助。：阶段：体系结构和设计操作：策略：环境强化：有效性：描述：使用完成必要任务所需的最低权限运行代码[参考文献76]。如果可能，使用仅用于单个任务的有限权限创建隔离帐户。这样，成功的攻击不会立即让攻击者访问软件的其余部分或其环境。例如，数据库应用程序很少需要作为数据库管理员运行，特别是在日常操作中。：
<h5>观察到的例子</h5>：：REFERENCE：CVE-2008-5044：DESCRIPTION：Race condition leading to a crash by calling a hook removal procedure while other activities are occurring at the same time.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5044REFERENCE：CVE-2008-2958：DESCRIPTION：chain：time-of-check time-of-use(TOCTOU)race condition in program allows bypass of protection mechanism that was designed to prevent symlink attacks.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-2958REFERENCE：CVE-2008-1570：DESCRIPTION：chain：time-of-check time-of-use(TOCTOU)race condition in program allows bypass of protection mechanism that was designed to prevent symlink attacks.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-1570REFERENCE：CVE-2008-0058：DESCRIPTION：Unsynchronized caching operation enables a race condition that causes messages to besent to a deallocated object.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-0058REFERENCE：CVE-2008-0379：DESCRIPTION：Race condition during initialization triggers a buffer overflow.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-0379REFERENCE：CVE-2007-6599：DESCRIPTION：Daemon crash by quickly performing operations and undoing them，which eventually leads to an operation that does not acquire a lock.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2007-6599REFERENCE：CVE-2007-6180：DESCRIPTION：chain：race condition triggers NULL pointer dereference：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2007-6180REFERENCE：CVE-2007-5794：DESCRIPTION：Race condition in library function could cause data to be sent to the wrong process.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2007-5794REFERENCE：CVE-2007-3970：DESCRIPTION：Race condition in file parser leads to heap corruption.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2007-3970REFERENCE：CVE-2008-5021：DESCRIPTION：chain：race condition allows attacker to access an object while itis still being initialized，causing software to access uninitialized memory.：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2008-5021REFERENCE：CVE-2009-4895：DESCRIPTION：chain：race condition for an argument value，possibly resulting in NULL dereference：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-4895REFERENCE：CVE-2009-3547：DESCRIPTION：chain：race condition might allow resource to be released before operating on it，leading to NULL dereference：LINK：https：//cve.mitre.org/cgi-bin/cvename.cgi？name=CVE-2009-3547
<h5>功能区域</h5>空
<h5>影响资源</h5>空
<h5>分类法映射</h5>分类法名称：plover：条目名称：争用条件：分类法名称：certJava安全编码：Entry ID：VNA03-J：Entry name：不要假设对独立原子方法的一组调用是原子的：
<h5>相关的攻击模式</h5>*26：29：
<h5>笔记</h5>类型：维护：注意：比赛条件与同步问题(CWE-662)之间的关系需要进一步发展。它们不一定是同一核心概念的两个视角，因为同步只是避免竞争条件的一种技术，同步可以用于除种族条件预防之外的其他目的。：类型：研究差距：注意：Web应用程序中的种族条件是研究不足的，可能是报道不足。然而，在2008年，人们对这一领域的兴趣越来越大。：类型：研究差距：注：竞赛条件研究的许多重点一直是时间检查使用时间(TOCTOU)变体(CWE-367)，但许多竞赛条件与同步问题有关，这些问题不一定需要时间检查。：类型：研究差距：注：从分类/分类学的角度来看，并发性与程序状态之间的关系需要更密切的调查，并可能在组织相关问题时有用：

